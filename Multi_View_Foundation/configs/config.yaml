# Multi-View Foundation configuration (scaffold)

paths:
  data_dir: "../Data"
  polymer_file: "../Data/Polymer/SMiPoly_polymers.gz"
  polymer_file_d2: "../Data/Polymer/PolyInfo_Homopolymer.csv"
  property_dir: "../Data/Property"
  results_dir: "results"
  paired_index: "results/paired_index.csv"

data:
  random_seed: 42
  max_samples_d1: 50000
  max_samples_d2: 12888

alignment_views: ["smiles", "smiles_bpe", "selfies", "group_selfies", "graph"]

views:
  smiles_bpe:
    enabled: true
  selfies:
    enabled: true
  group_selfies:
    enabled: true
    tokenizer_path: "../Bi_Diffusion_Group_SELFIES/results/tokenizer.pkl"
  graph:
    enabled: true

model:
  projection_dim: 384  # default for small; run_pipeline.sh aligns with 9-method backbone sizes: 384/640/960/1280
  projection_hidden_dims: [768]  # default for small; presets: [768],[1280],[1920],[2560]
  view_dropout: 0.3
  temperature: 0.07

training:
  batch_size: 512
  learning_rate: 1.0e-4
  max_steps: 200000
  warmup_steps: 2000

alignment_training:
  batch_size: 256
  learning_rate: 1.0e-3
  weight_decay: 0.0
  max_epochs: 10
  val_ratio: 0.1
  log_every: 50
  datasets: ["d1"]

alignment_e2e:
  batch_size: 64
  learning_rate: 1.0e-5
  weight_decay: 0.01
  max_epochs: 3
  val_ratio: 0.05
  log_every: 50
  datasets: ["d1"]
  max_samples: null

pipeline:
  step1_alignment_mode: "frozen"  # none|frozen|e2e|both
  step2_use_alignment: true
  step3_use_alignment: true
  step4_use_alignment: true
  step5_use_alignment: true

evaluation:
  recall_ks: [1, 5, 10]
  max_samples_per_dataset: 5000

ood:
  nn_k: 50
  use_faiss: true

property:
  files: ["Tg.csv", "Eg.csv", "Tm.csv", "Td.csv"]
  max_samples: null
  train_ratio: 0.8
  val_ratio: 0.1
  test_ratio: 0.1
  model_type: "mlp"
  views: null
  use_alignment: true
  hyperparameter_tuning:
    n_trials: 150
    enabled: true
    tuning_epochs: 35
    tuning_patience: 10
    final_training_epochs: 200
    metric: "r2"
    search_space:
      num_layers: [3, 4, 5]
      neurons: [64, 128, 256, 512, 1024]
      learning_rate: [4.0e-4, 6.0e-4, 8.0e-4, 1.0e-3]
      dropout: [0.1, 0.2, 0.3]
      batch_size: [8, 16, 32, 64, 128]

foundation_inverse:
  enabled: true
  candidate_source: "csv"  # csv|resample
  candidates_csv: ""
  smiles_column: ""
  property: "Td"  # Tg, Tm, Td, Eg
  target: 300.0
  target_mode: "ge"  # window|ge|le
  epsilon: 20.0
  sampling_target: 100              # used when candidate_source=resample
  sampling_num_per_batch: 512       # candidates generated each outer batch
  sampling_batch_size: 128          # model decode batch size inside sampler
  sampling_max_batches: 200         # hard stop to avoid infinite loops
  sampling_temperature: null        # null => use method sampling.temperature
  sampling_num_atoms: null          # graph-only optional override
  # Optional comma-separated class filter. Supported classes:
  # polyimide, polyester, polyamide, polyurethane, polyether,
  # polysiloxane, polycarbonate, polysulfone, polyacrylate, polystyrene
  target_class: "polyamide"         # empty string disables class filter
  require_validity: true
  require_two_stars: true
  require_novel: true
  require_unique: true
  max_sa: 4.0
  property_model_path: ""
  rerank_strategy: "d2_distance"
  rerank_top_k: 100
  ood_k: 5
  encoder_view: "smiles"  # selects F5 sampling + embedding view: smiles|smiles_bpe|selfies|group_selfies|graph
  use_alignment: true
  alignment_checkpoint: ""

ood_aware_inverse:
  enabled: false
  candidate_scores_csv: ""      # default: results/step5_foundation_inverse/files/candidate_scores.csv
  encoder_view: ""              # fallback: foundation_inverse.encoder_view
  property: ""                  # fallback: foundation_inverse.property
  target: null                  # fallback: foundation_inverse.target
  target_mode: ""               # fallback: foundation_inverse.target_mode
  epsilon: null                 # fallback: foundation_inverse.epsilon
  top_k: 100
  property_weight: 0.7
  ood_weight: 0.3
  normalization: "minmax"       # minmax|rank|none
  ood_k: 5
  compute_d2_distance_if_missing: true
  use_alignment: true
  alignment_checkpoint: ""

smiles_encoder:
  method_dir: "../Bi_Diffusion_SMILES"
  config_path: "../Bi_Diffusion_SMILES/configs/config.yaml"
  results_dir: ""
  model_size: "small"
  step_dir: "step1_backbone"
  checkpoint_name: "backbone_best.pt"
  tokenizer_path: ""
  checkpoint_path: ""
  pooling: "mean"
  timestep: 1
  batch_size: 256
  device: "auto"
  max_samples_d1: null
  max_samples_d2: null

smiles_bpe_encoder:
  method_dir: "../Bi_Diffusion_SMILES_BPE"
  config_path: "../Bi_Diffusion_SMILES_BPE/configs/config.yaml"
  results_dir: ""
  model_size: "small"
  step_dir: "step1_backbone"
  checkpoint_name: "backbone_best.pt"
  tokenizer_path: ""
  checkpoint_path: ""
  pooling: "mean"
  timestep: 1
  batch_size: 256
  device: "auto"
  max_samples_d1: null
  max_samples_d2: null

selfies_encoder:
  method_dir: "../Bi_Diffusion_SELFIES"
  config_path: "../Bi_Diffusion_SELFIES/configs/config.yaml"
  results_dir: ""
  model_size: "small"
  step_dir: "step1_backbone"
  checkpoint_name: "backbone_best.pt"
  tokenizer_path: ""
  checkpoint_path: ""
  pooling: "mean"
  timestep: 1
  batch_size: 256
  device: "auto"
  max_samples_d1: null
  max_samples_d2: null

group_selfies_encoder:
  method_dir: "../Bi_Diffusion_Group_SELFIES"
  config_path: "../Bi_Diffusion_Group_SELFIES/configs/config.yaml"
  results_dir: ""
  model_size: "small"
  step_dir: "step1_backbone"
  checkpoint_name: "backbone_best.pt"
  tokenizer_path: ""
  checkpoint_path: ""
  pooling: "mean"
  timestep: 1
  batch_size: 128
  device: "auto"
  max_samples_d1: null
  max_samples_d2: null

graph_encoder:
  method_dir: "../Bi_Diffusion_graph"
  config_path: "../Bi_Diffusion_graph/configs/config.yaml"
  results_dir: ""
  model_size: "small"
  step_dir: "step1_backbone"
  checkpoint_name: "graph_backbone_best.pt"
  tokenizer_path: ""
  graph_config_path: ""
  checkpoint_path: ""
  pooling: "mean"
  timestep: 1
  batch_size: 64
  device: "auto"
  max_samples_d1: null
  max_samples_d2: null
